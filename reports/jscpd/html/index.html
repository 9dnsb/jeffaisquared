<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">24</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">2471</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">305</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">1106 (44.76%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#typescript-clones">typescript</a></td><td class="py-3 px-6">24</td><td class="py-3 px-6">2471</td><td class="py-3 px-6">305</td><td class="py-3 px-6">1106</td><td class="py-3 px-6">9067</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="typescript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">typescript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">src\app\api\auth\session\route.test.ts (Line 54:2 - Line 55:6), src\app\api\auth\session\route.test.ts (Line 41:2 - Line 42:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-typescript text-sm text-gray-800">= {
        json: () =&gt; Promise.resolve({ error</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\session\route.test.ts (Line 65:7 - Line 66:9), src\app\api\auth\session\route.test.ts (Line 28:5 - Line 29:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-typescript text-sm text-gray-800">expect(authApiUtils.validateSession).toHaveBeenCalledWith(true)
      expect(response</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\session\route.test.ts (Line 70:39 - Line 72:5), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = {
        user: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\session\route.test.ts (Line 73:7 - Line 75:5), src\app\api\auth\session\route.test.ts (Line 40:7 - Line 42:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-typescript text-sm text-gray-800">}
      const mockSuccessResponse = {
        json: () =&gt; Promise.resolve({ authenticated: true, user: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\session\route.test.ts (Line 75:2 - Line 85:2), src\app\api\auth\session\route.test.ts (Line 42:2 - Line 53:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-typescript text-sm text-gray-800">})
      }

      setupSuccessTest(mockSession, mockSuccessResponse)

      const response = await GET()

      expectSuccessTest(mockSession)
      expect(response).toBe(mockSuccessResponse)
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.ts (Line 33:1 - Line 34:2), src\app\api\auth\session\route.ts (Line 3:1 - Line 4:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-typescript text-sm text-gray-800">export async function GET() {
  const { session, error } = await validateSession()</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.ts (Line 34:2 - Line 41:8), src\app\api\auth\session\route.ts (Line 4:5 - Line 11:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-typescript text-sm text-gray-800">)

  if (error) {
    return error
  }

  return createSuccessResponse({
    isValid</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 2:1 - Line 3:5), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 2:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { POST</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 3:2 - Line 6:20), src\app\api\auth\session\route.test.ts (Line 2:2 - Line 5:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-typescript text-sm text-gray-800">GET } from './route'
import { TEST_CONSTANTS } from '../../../../test/test-utils'

// Mock NextRequest</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 12:1 - Line 13:17), src\app\api\auth\session\route.test.ts (Line 6:1 - Line 7:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-typescript text-sm text-gray-800">vi.mock('@/lib/auth-api-utils', () =&gt; ({
  parseRequestBody</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 15:3 - Line 18:20), src\app\api\auth\session\route.test.ts (Line 7:3 - Line 11:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-typescript text-sm text-gray-800">createSuccessResponse: vi.fn(),
  validateSession: vi.fn()
}))
// jscpd:ignore-end</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 31:9 - Line 37:9), src\app\api\auth\session\route.test.ts (Line 12:13 - Line 17:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-typescript text-sm text-gray-800">: any

  beforeEach(async () =&gt; {
    vi.clearAllMocks()

    authApiUtils = await import('@/lib/auth-api-utils')
    supabase</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 58:9 - Line 63:6), src\app\api\auth\session\route.test.ts (Line 22:7 - Line 25:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-typescript text-sm text-gray-800">error: null
      })

      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 68:2 - Line 70:8), src\app\api\auth\session\route.test.ts (Line 28:5 - Line 30:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-typescript text-sm text-gray-800">)
      expect(authApiUtils.createSuccessResponse).toHaveBeenCalledWith({
        message</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 71:2 - Line 74:20), src\app\api\auth\session\route.test.ts (Line 49:12 - Line 53:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-typescript text-sm text-gray-800">)
      expect(response).toBe(mockSuccessResponse)
    })
    // jscpd:ignore-end</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 94:43 - Line 96:14), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 48:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validResetPasswordData)
      const supabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 97:2 - Line 105:14), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 58:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validResetPasswordData,
        error: null
      })

      supabase.auth.updateUser.mockResolvedValue({
        error: supabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 108:18 - Line 112:9), src\app\api\auth\reset-password\route.test.ts (Line 61:20 - Line 65:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-typescript text-sm text-gray-800">)

      const response = await POST(request)

      expect(supabase</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 110:8 - Line 115:20), src\app\api\auth\reset-password\route.test.ts (Line 65:2 - Line 69:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-typescript text-sm text-gray-800">)

      expect(supabase.auth.updateUser).toHaveBeenCalledWith({
        password: validResetPasswordData.password
      })
      expect(authApiUtils.handleSupabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 124:2 - Line 127:5), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 53:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 129:2 - Line 134:4), src\app\api\auth\reset-password\route.test.ts (Line 61:20 - Line 66:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-typescript text-sm text-gray-800">)

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(supabase.auth.updateUser).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 139:3 - Line 140:57), src\app\api\auth\session\route.test.ts (Line 36:3 - Line 37:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-typescript text-sm text-gray-800">describe('GET', () =&gt; {
    it('should return valid session when user is authenticated'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 140:57 - Line 142:2), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 40:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = {
        user: { id: TEST_CONSTANTS.USER_ID, email: TEST_CONSTANTS.EMAIL },</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 148:7 - Line 157:4), src\app\api\auth\session\route.test.ts (Line 56:7 - Line 63:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.validateSession.mockResolvedValue({
        session: mockSession,
        error: null
      })

      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const response = await GET</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 155:20 - Line 159:2), src\app\api\auth\session\route.test.ts (Line 61:2 - Line 65:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-typescript text-sm text-gray-800">)

      const response = await GET()

      expect(authApiUtils.validateSession).toHaveBeenCalledWith()</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 159:2 - Line 161:8), src\app\api\auth\session\route.test.ts (Line 28:5 - Line 30:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-typescript text-sm text-gray-800">)
      expect(authApiUtils.createSuccessResponse).toHaveBeenCalledWith({
        isValid</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 163:7 - Line 167:52), src\app\api\auth\reset-password\route.test.ts (Line 71:7 - Line 53:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-typescript text-sm text-gray-800">})
      expect(response).toBe(mockSuccessResponse)
    })

    it('should return error when session validation fails'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 167:52 - Line 169:6), src\app\api\auth\session\route.test.ts (Line 53:61 - Line 55:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockError = {
        error</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 171:7 - Line 181:4), src\app\api\auth\session\route.test.ts (Line 56:7 - Line 160:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.validateSession.mockResolvedValue({
        session: null,
        error: mockError
      })

      const response = await GET()

      expect(authApiUtils.validateSession).toHaveBeenCalledWith()
      expect(authApiUtils.createSuccessResponse).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 180:2 - Line 182:7), src\app\api\auth\session\route.test.ts (Line 66:10 - Line 68:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-typescript text-sm text-gray-800">)
      expect(authApiUtils.createSuccessResponse).not.toHaveBeenCalled()
      expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 181:22 - Line 182:10), src\app\api\auth\reset-password\route.test.ts (Line 134:11 - Line 135:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-typescript text-sm text-gray-800">).not.toHaveBeenCalled()
      expect(response).toBe(mockError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 181:2 - Line 183:2), src\app\api\auth\session\route.test.ts (Line 65:5 - Line 67:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-typescript text-sm text-gray-800">)
      expect(response).toBe(mockError)
    }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 185:53 - Line 187:20), src\app\api\auth\session\route.test.ts (Line 53:61 - Line 169:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockError = {
        error: 'No active session'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 187:20 - Line 199:9), src\app\api\auth\reset-password\route.test.ts (Line 169:15 - Line 160:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-typescript text-sm text-gray-800">,
        status: 401
      }

      authApiUtils.validateSession.mockResolvedValue({
        session: null,
        error: mockError
      })

      const response = await GET()

      expect(authApiUtils.validateSession).toHaveBeenCalledWith()
      expect(response</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\reset-password\route.test.ts (Line 198:21 - Line 201:2), src\app\api\auth\reset-password\route.test.ts (Line 181:17 - Line 185:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-typescript text-sm text-gray-800">()
      expect(response).toBe(mockError)
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.ts (Line 5:2 - Line 8:7), src\app\api\auth\reset-password\route.ts (Line 11:2 - Line 14:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-typescript text-sm text-gray-800">)

export async function POST(request: NextRequest) {
  return</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.test.ts (Line 1:1 - Line 2:2), src\app\api\auth\reset-password\route.test.ts (Line 1:1 - Line 1:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-typescript text-sm text-gray-800">// jscpd:ignore-start - Test boilerplate patterns are inherently repetitive
import { describe, it, expect, vi, beforeEach,</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.test.ts (Line 6:1 - Line 13:29), src\app\api\auth\reset-password\route.test.ts (Line 4:1 - Line 11:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-typescript text-sm text-gray-800">import { TEST_CONSTANTS } from '../../../../test/test-utils'

// Mock NextRequest
const mockRequest = (body: any): any =&gt; ({
  json: vi.fn().mockResolvedValue(body)
})

// Mock registration-handler</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.test.ts (Line 34:64 - Line 35:18), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 47:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.test.ts (Line 38:13 - Line 42:23), src\app\api\auth\reset-password\route.test.ts (Line 61:20 - Line 65:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-typescript text-sm text-gray-800">)

      const response = await POST(request)

      expect(mockHandleRegistration</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\register\route.test.ts (Line 42:23 - Line 43:9), src\app\api\auth\reset-password\route.test.ts (Line 65:17 - Line 66:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-typescript text-sm text-gray-800">).toHaveBeenCalledWith(request, expect.any(Object))
      expect(response</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 1:1 - Line 2:2), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 3:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { POST }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 13:27 - Line 16:19), src\app\api\auth\session\route.test.ts (Line 8:16 - Line 11:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-typescript text-sm text-gray-800">: vi.fn()
}))

describe('/api/auth/logout'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 27:3 - Line 29:8), src\app\api\auth\session\route.test.ts (Line 14:3 - Line 16:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-typescript text-sm text-gray-800">beforeEach(async () =&gt; {
    vi.clearAllMocks()
    console</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 41:3 - Line 44:3), src\app\api\auth\reset-password\route.test.ts (Line 38:3 - Line 41:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-typescript text-sm text-gray-800">})

  describe('POST', () =&gt; {
    it</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 43:3 - Line 44:36), src\app\api\auth\register\route.test.ts (Line 33:3 - Line 34:64)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-typescript text-sm text-gray-800">describe('POST', () =&gt; {
    it('should successfully sign out user'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 48:5 - Line 50:2), src\app\api\auth\reset-password\route.test.ts (Line 61:22 - Line 63:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-typescript text-sm text-gray-800">.mockReturnValue(mockSuccessResponse)

      const response = await POST()</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 60:7 - Line 64:41), src\app\api\auth\reset-password\route.test.ts (Line 71:7 - Line 53:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-typescript text-sm text-gray-800">})
      expect(response).toBe(mockSuccessResponse)
    })

    it('should return error when signOut fails'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 69:5 - Line 71:2), src\app\api\auth\reset-password\route.test.ts (Line 108:20 - Line 110:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-typescript text-sm text-gray-800">.mockReturnValue(mockErrorResponse)

      const response = await POST()</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 69:18 - Line 73:12), src\app\api\auth\logout\route.test.ts (Line 48:20 - Line 52:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-typescript text-sm text-gray-800">)

      const response = await POST()

      expect(mockSignOut</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 71:5 - Line 75:6), src\app\api\auth\logout\route.test.ts (Line 52:17 - Line 55:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-typescript text-sm text-gray-800">()

      expect(mockSignOut).toHaveBeenCalled()
      expect(NextResponse.json).toHaveBeenCalledWith(
        { error</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 76:2 - Line 79:6), src\app\api\auth\logout\route.test.ts (Line 56:7 - Line 58:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-typescript text-sm text-gray-800">}
      )
      expect(console.log).toHaveBeenCalledWith('Logout attempt:', {
        success: false</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 81:2 - Line 85:34), src\app\api\auth\reset-password\route.test.ts (Line 115:14 - Line 119:42)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-typescript text-sm text-gray-800">)
      expect(response).toBe(mockErrorResponse)
    })

    it('should handle unexpected errors'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 89:16 - Line 94:13), src\app\api\auth\logout\route.test.ts (Line 68:2 - Line 52:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-typescript text-sm text-gray-800">)
      NextResponse.json.mockReturnValue(mockErrorResponse)

      const response = await POST()

      expect(NextResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 92:5 - Line 95:22), src\app\api\auth\logout\route.test.ts (Line 53:17 - Line 75:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-typescript text-sm text-gray-800">()

      expect(NextResponse.json).toHaveBeenCalledWith(
        { error: ERROR_MESSAGES.INTERNAL_SERVER_ERROR</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 98:16 - Line 102:49), src\app\api\auth\reset-password\route.test.ts (Line 115:14 - Line 119:42)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-typescript text-sm text-gray-800">)
      expect(response).toBe(mockErrorResponse)
    })

    it('should handle supabase client creation failure'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 103:26 - Line 106:12), src\app\api\auth\logout\route.test.ts (Line 86:19 - Line 89:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup56"><code class="language-typescript text-sm text-gray-800">)
      const mockErrorResponse = { error: ERROR_MESSAGES.INTERNAL_SERVER_ERROR }

      supabaseServer.createSupabaseServerClient.mockRejectedValue(clientError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 106:12 - Line 111:8), src\app\api\auth\logout\route.test.ts (Line 68:2 - Line 52:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup57"><code class="language-typescript text-sm text-gray-800">)
      NextResponse.json.mockReturnValue(mockErrorResponse)

      const response = await POST()

      expect(console</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 109:2 - Line 111:12), src\app\api\auth\logout\route.test.ts (Line 97:7 - Line 98:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup58"><code class="language-typescript text-sm text-gray-800">)

      expect(console.error).toHaveBeenCalledWith('Logout error:', clientError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 111:12 - Line 116:9), src\app\api\auth\logout\route.test.ts (Line 53:2 - Line 98:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup59"><code class="language-typescript text-sm text-gray-800">)
      expect(NextResponse.json).toHaveBeenCalledWith(
        { error: ERROR_MESSAGES.INTERNAL_SERVER_ERROR },
        { status: 500 }
      )
      expect(response</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\logout\route.test.ts (Line 114:2 - Line 118:2), src\app\api\auth\logout\route.test.ts (Line 81:7 - Line 119:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup60"><code class="language-typescript text-sm text-gray-800">}
      )
      expect(response).toBe(mockErrorResponse)
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.ts (Line 1:1 - Line 3:2), src\app\api\auth\reset-password\route.ts (Line 1:1 - Line 3:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup61"><code class="language-typescript text-sm text-gray-800">import { NextRequest } from 'next/server'
import { z } from 'zod'
import {</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.ts (Line 8:2 - Line 12:12), src\app\api\auth\reset-password\route.ts (Line 10:20 - Line 14:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup62"><code class="language-typescript text-sm text-gray-800">),
})

export async function POST(request: NextRequest) {
  const { data: validatedData, error: parseError } = await parseRequestBody(request, LoginSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.ts (Line 12:12 - Line 18:9), src\app\api\auth\reset-password\route.ts (Line 14:20 - Line 20:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup63"><code class="language-typescript text-sm text-gray-800">)

  if (parseError) {
    return parseError
  }

  const supabase</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.ts (Line 26:5 - Line 28:8), src\app\api\auth\logout\route.ts (Line 10:7 - Line 12:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup64"><code class="language-typescript text-sm text-gray-800">success: !error,
    error: error?.message,
    hasUser</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.ts (Line 30:3 - Line 37:5), src\app\api\auth\reset-password\route.ts (Line 22:3 - Line 29:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup65"><code class="language-typescript text-sm text-gray-800">})

  if (error) {
    return handleSupabaseError(error)
  }

  return createSuccessResponse({
    user</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 1:1 - Line 4:7), src\app\api\auth\reset-password\route.test.ts (Line 1:1 - Line 4:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup66"><code class="language-typescript text-sm text-gray-800">// jscpd:ignore-start - Test boilerplate patterns are inherently repetitive
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { POST } from './route'
import</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 3:2 - Line 16:2), src\app\api\auth\reset-password\route.test.ts (Line 3:2 - Line 15:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup67"><code class="language-typescript text-sm text-gray-800">} from './route'
import { TEST_CONSTANTS } from '../../../../test/test-utils'

// Mock NextRequest
const mockRequest = (body: any): any =&gt; ({
  json: vi.fn().mockResolvedValue(body)
})

// Mock auth-api-utils
vi.mock('@/lib/auth-api-utils', () =&gt; ({
  parseRequestBody: vi.fn(),
  handleSupabaseError: vi.fn(),
  createSuccessResponse: vi.fn()
}</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 19:1 - Line 24:9), src\app\api\auth\logout\route.test.ts (Line 12:1 - Line 20:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup68"><code class="language-typescript text-sm text-gray-800">vi.mock('../../../../../lib/supabase-server', () =&gt; ({
  createSupabaseServerClient: vi.fn()
}))
// jscpd:ignore-end

describe</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 24:18 - Line 26:15), src\app\api\auth\reset-password\route.test.ts (Line 29:27 - Line 31:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup69"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  let authApiUtils: any
  let supabaseServer</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 32:3 - Line 36:13), src\app\api\auth\session\route.test.ts (Line 14:3 - Line 30:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup70"><code class="language-typescript text-sm text-gray-800">beforeEach(async () =&gt; {
    vi.clearAllMocks()
    console.log = vi.fn()

    authApiUtils</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 39:2 - Line 42:19), src\app\api\auth\logout\route.test.ts (Line 34:2 - Line 37:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup71"><code class="language-typescript text-sm text-gray-800">= vi.fn()
    mockSupabaseClient = {
      auth: {
        signInWithPassword</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 43:7 - Line 49:56), src\app\api\auth\logout\route.test.ts (Line 38:7 - Line 34:64)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup72"><code class="language-typescript text-sm text-gray-800">}
    }
    supabaseServer.createSupabaseServerClient.mockResolvedValue(mockSupabaseClient)
  })

  describe('POST', () =&gt; {
    it('should successfully login user with valid credentials'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 50:2 - Line 53:2), src\app\api\auth\register\route.test.ts (Line 26:2 - Line 28:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup73"><code class="language-typescript text-sm text-gray-800">= {
        email: TEST_CONSTANTS.EMAIL,
        password: TEST_CONSTANTS.PASSWORD
      }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 56:2 - Line 57:6), src\app\api\auth\session\route.test.ts (Line 39:2 - Line 40:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup74"><code class="language-typescript text-sm text-gray-800">{ id: TEST_CONSTANTS.USER_ID, email: TEST_CONSTANTS.EMAIL }
      const</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 58:2 - Line 61:10), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 53:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup75"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: loginData</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 66:2 - Line 75:15), src\app\api\auth\session\route.test.ts (Line 21:12 - Line 66:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup76"><code class="language-typescript text-sm text-gray-800">,
        error: null
      })

      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(supabaseServer</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 74:2 - Line 76:23), src\app\api\auth\logout\route.test.ts (Line 50:2 - Line 53:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup77"><code class="language-typescript text-sm text-gray-800">)
      expect(supabaseServer.createSupabaseServerClient).toHaveBeenCalled()
      expect(mockSignInWithPassword</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 78:10 - Line 81:5), src\app\api\auth\reset-password\route.test.ts (Line 67:23 - Line 30:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup78"><code class="language-typescript text-sm text-gray-800">.password
      })
      expect(authApiUtils.createSuccessResponse).toHaveBeenCalledWith({
        user</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 83:7 - Line 84:20), src\app\api\auth\logout\route.test.ts (Line 56:7 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup79"><code class="language-typescript text-sm text-gray-800">})
      expect(console.log).toHaveBeenCalledWith(loginAttemptMessage</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 90:7 - Line 94:49), src\app\api\auth\reset-password\route.test.ts (Line 71:7 - Line 53:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup80"><code class="language-typescript text-sm text-gray-800">})
      expect(response).toBe(mockSuccessResponse)
    })

    it('should return error when request parsing fails'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 94:49 - Line 95:2), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 47:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup81"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest({</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 96:2 - Line 106:4), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 75:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup82"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null,
        error: mockParseError
      })

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(supabaseServer.createSupabaseServerClient).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 106:27 - Line 110:3), src\app\api\auth\reset-password\route.test.ts (Line 134:11 - Line 137:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup83"><code class="language-typescript text-sm text-gray-800">).not.toHaveBeenCalled()
      expect(response).toBe(mockParseError)
    })

    it</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 110:47 - Line 113:16), src\app\api\auth\login\route.test.ts (Line 49:56 - Line 28:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup84"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const loginData = {
        email: TEST_CONSTANTS.EMAIL,
        password: 'wrongpassword'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 117:2 - Line 125:5), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 66:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup85"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: loginData,
        error: null
      })

      mockSignInWithPassword.mockResolvedValue({
        data: { user: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 126:9 - Line 133:23), src\app\api\auth\reset-password\route.test.ts (Line 105:9 - Line 65:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup86"><code class="language-typescript text-sm text-gray-800">error: supabaseError
      })

      authApiUtils.handleSupabaseError.mockReturnValue(mockErrorResponse)

      const response = await POST(request)

      expect(mockSignInWithPassword</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 131:8 - Line 137:20), src\app\api\auth\login\route.test.ts (Line 75:2 - Line 80:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup87"><code class="language-typescript text-sm text-gray-800">)

      expect(mockSignInWithPassword).toHaveBeenCalledWith({
        email: loginData.email,
        password: loginData.password
      })
      expect(authApiUtils.handleSupabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 135:10 - Line 138:8), src\app\api\auth\reset-password\route.test.ts (Line 113:23 - Line 116:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup88"><code class="language-typescript text-sm text-gray-800">.password
      })
      expect(authApiUtils.handleSupabaseError).toHaveBeenCalledWith(supabaseError)
      expect(console</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 137:14 - Line 140:6), src\app\api\auth\logout\route.test.ts (Line 56:2 - Line 86:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup89"><code class="language-typescript text-sm text-gray-800">)
      expect(console.log).toHaveBeenCalledWith(loginAttemptMessage, {
        email: loginData.email,
        success: false</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 144:7 - Line 148:58), src\app\api\auth\logout\route.test.ts (Line 81:7 - Line 119:42)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup90"><code class="language-typescript text-sm text-gray-800">})
      expect(response).toBe(mockErrorResponse)
    })

    it('should handle successful login with user but no session'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 148:58 - Line 156:20), src\app\api\auth\login\route.test.ts (Line 49:56 - Line 57:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup91"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const loginData = {
        email: TEST_CONSTANTS.EMAIL,
        password: TEST_CONSTANTS.PASSWORD
      }
      const request = mockRequest(loginData)

      const mockUser = { id: TEST_CONSTANTS.USER_ID, email: TEST_CONSTANTS.EMAIL }
      const mockSuccessResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 155:2 - Line 156:5), src\app\api\auth\login\route.test.ts (Line 57:2 - Line 58:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup92"><code class="language-typescript text-sm text-gray-800">}
      const mockSuccessResponse = { user: mockUser, session: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 156:2 - Line 164:5), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 66:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup93"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: loginData,
        error: null
      })

      mockSignInWithPassword.mockResolvedValue({
        data: { user: mockUser, session: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 164:2 - Line 172:22), src\app\api\auth\login\route.test.ts (Line 66:2 - Line 65:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup94"><code class="language-typescript text-sm text-gray-800">},
        error: null
      })

      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const response = await POST(request)

      expect(authApiUtils.createSuccessResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 170:8 - Line 174:5), src\app\api\auth\session\route.test.ts (Line 28:5 - Line 82:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup95"><code class="language-typescript text-sm text-gray-800">)

      expect(authApiUtils.createSuccessResponse).toHaveBeenCalledWith({
        user: mockUser,
        session: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 175:7 - Line 181:6), src\app\api\auth\logout\route.test.ts (Line 56:7 - Line 89:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup96"><code class="language-typescript text-sm text-gray-800">})
      expect(console.log).toHaveBeenCalledWith(loginAttemptMessage, {
        email: loginData.email,
        success: true,
        error: undefined,
        hasUser: true,
        hasSession: false</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\login\route.test.ts (Line 180:5 - Line 186:2), src\app\api\auth\login\route.test.ts (Line 142:6 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup97"><code class="language-typescript text-sm text-gray-800">,
        hasSession: false
      })
      expect(response).toBe(mockSuccessResponse)
    })
  })
})</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 1:1 - Line 4:2), src\app\api\auth\reset-password\route.ts (Line 1:1 - Line 4:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup98"><code class="language-typescript text-sm text-gray-800">import { NextRequest } from 'next/server'
import { z } from 'zod'
import supabase from '../../../../../lib/supabase'
import { parseRequestBody, handleSupabaseError, createSuccessResponse }</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 4:1 - Line 6:21), src\app\api\auth\login\route.ts (Line 4:1 - Line 6:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup99"><code class="language-typescript text-sm text-gray-800">import { parseRequestBody, handleSupabaseError, createSuccessResponse } from '@/lib/auth-api-utils'

const ForgotPasswordSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 6:2 - Line 8:11), src\app\api\auth\login\route.ts (Line 6:2 - Line 8:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup100"><code class="language-typescript text-sm text-gray-800">= z.object({
  email: z.email(),
  redirectTo</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 8:2 - Line 12:21), src\app\api\auth\reset-password\route.ts (Line 10:20 - Line 14:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup101"><code class="language-typescript text-sm text-gray-800">),
})

export async function POST(request: NextRequest) {
  const { data: validatedData, error: parseError } = await parseRequestBody(request, ForgotPasswordSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 12:21 - Line 18:22), src\app\api\auth\reset-password\route.ts (Line 14:20 - Line 20:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup102"><code class="language-typescript text-sm text-gray-800">)

  if (parseError) {
    return parseError
  }

  const { error } = await supabase.auth.resetPasswordForEmail</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.ts (Line 21:11 - Line 30:48), src\app\api\auth\login\route.ts (Line 29:8 - Line 29:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup103"><code class="language-typescript text-sm text-gray-800">,
    }
  )

  if (error) {
    return handleSupabaseError(error)
  }

  return createSuccessResponse({
    message: 'Check your email for the password reset link!'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 1:1 - Line 23:22), src\app\api\auth\reset-password\route.test.ts (Line 1:1 - Line 24:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup104"><code class="language-typescript text-sm text-gray-800">// jscpd:ignore-start - Test boilerplate patterns are inherently repetitive
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { POST } from './route'
import { TEST_CONSTANTS } from '../../../../test/test-utils'

// Mock NextRequest
const mockRequest = (body: any): any =&gt; ({
  json: vi.fn().mockResolvedValue(body)
})

// Mock auth-api-utils
vi.mock('@/lib/auth-api-utils', () =&gt; ({
  parseRequestBody: vi.fn(),
  handleSupabaseError: vi.fn(),
  createSuccessResponse: vi.fn()
}))
// jscpd:ignore-end

// Mock supabase client
vi.mock('../../../../../lib/supabase', () =&gt; ({
  default: {
    auth: {
      resetPasswordForEmail</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 23:22 - Line 28:28), src\app\api\auth\reset-password\route.test.ts (Line 24:11 - Line 29:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup105"><code class="language-typescript text-sm text-gray-800">: vi.fn()
    }
  }
}))

describe('/api/auth/forgot-password'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 28:28 - Line 39:6), src\app\api\auth\reset-password\route.test.ts (Line 29:27 - Line 40:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup106"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  let authApiUtils: any
  let supabase: any

  beforeEach(async () =&gt; {
    vi.clearAllMocks()

    authApiUtils = await import('@/lib/auth-api-utils')
    supabase = (await import('../../../../../lib/supabase')).default
  })

  const</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 42:3 - Line 45:48), src\app\api\auth\register\route.test.ts (Line 31:3 - Line 34:64)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup107"><code class="language-typescript text-sm text-gray-800">}

  describe('POST', () =&gt; {
    it('should successfully send password reset email'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 45:48 - Line 46:24), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 47:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup108"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validForgotPasswordData</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 49:7 - Line 52:24), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 53:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup109"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validForgotPasswordData</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 52:24 - Line 56:22), src\app\api\auth\reset-password\route.test.ts (Line 53:23 - Line 57:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup110"><code class="language-typescript text-sm text-gray-800">,
        error: null
      })

      supabase.auth.resetPasswordForEmail</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 56:22 - Line 65:22), src\app\api\auth\reset-password\route.test.ts (Line 57:11 - Line 66:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup111"><code class="language-typescript text-sm text-gray-800">.mockResolvedValue({
        error: null
      })

      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(supabase.auth.resetPasswordForEmail</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 69:9 - Line 72:48), src\app\api\auth\reset-password\route.test.ts (Line 68:7 - Line 70:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup112"><code class="language-typescript text-sm text-gray-800">}
      )
      expect(authApiUtils.createSuccessResponse).toHaveBeenCalledWith({
        message: 'Check your email for the password reset link!'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 73:7 - Line 89:4), src\app\api\auth\reset-password\route.test.ts (Line 71:7 - Line 65:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup113"><code class="language-typescript text-sm text-gray-800">})
      expect(response).toBe(mockSuccessResponse)
    })

    it('should return error when request parsing fails', async () =&gt; {
      const request = mockRequest({})
      const mockParseError = { error: 'Invalid email format' }

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null,
        error: mockParseError
      })

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(supabase.auth.resetPasswordForEmail).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 89:22 - Line 93:54), src\app\api\auth\reset-password\route.test.ts (Line 134:11 - Line 110:47)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup114"><code class="language-typescript text-sm text-gray-800">).not.toHaveBeenCalled()
      expect(response).toBe(mockParseError)
    })

    it('should handle Supabase resetPasswordForEmail errors'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 93:54 - Line 95:14), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 47:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup115"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validForgotPasswordData)
      const supabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 96:2 - Line 104:14), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 57:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup116"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validForgotPasswordData,
        error: null
      })

      supabase.auth.resetPasswordForEmail.mockResolvedValue({
        error: supabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 103:22 - Line 111:22), src\app\api\auth\reset-password\route.test.ts (Line 104:11 - Line 112:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup117"><code class="language-typescript text-sm text-gray-800">.mockResolvedValue({
        error: supabaseError
      })

      authApiUtils.handleSupabaseError.mockReturnValue(mockErrorResponse)

      const response = await POST(request)

      expect(supabase.auth.resetPasswordForEmail</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 109:8 - Line 117:20), src\app\api\auth\forgot-password\route.test.ts (Line 64:2 - Line 71:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup118"><code class="language-typescript text-sm text-gray-800">)

      expect(supabase.auth.resetPasswordForEmail).toHaveBeenCalledWith(
        validForgotPasswordData.email,
        {
          redirectTo: validForgotPasswordData.redirectTo
        }
      )
      expect(authApiUtils.handleSupabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 115:9 - Line 121:42), src\app\api\auth\reset-password\route.test.ts (Line 114:7 - Line 119:42)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup119"><code class="language-typescript text-sm text-gray-800">}
      )
      expect(authApiUtils.handleSupabaseError).toHaveBeenCalledWith(supabaseError)
      expect(response).toBe(mockErrorResponse)
    })

    it('should validate email format in request'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 126:12 - Line 137:15), src\app\api\auth\login\route.test.ts (Line 95:2 - Line 43:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup120"><code class="language-typescript text-sm text-gray-800">)
      const mockParseError = { error: 'Invalid email format' }

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null,
        error: mockParseError
      })

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(response).toBe(mockParseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 136:2 - Line 140:44), src\app\api\auth\reset-password\route.test.ts (Line 134:2 - Line 110:47)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup121"><code class="language-typescript text-sm text-gray-800">)
      expect(response).toBe(mockParseError)
    })

    it('should validate redirectTo URL in request'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 140:44 - Line 142:15), src\app\api\auth\forgot-password\route.test.ts (Line 121:42 - Line 123:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup122"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const invalidData = {
        email: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 141:2 - Line 143:14), src\app\api\auth\forgot-password\route.test.ts (Line 39:2 - Line 41:37)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup123"><code class="language-typescript text-sm text-gray-800">= {
        email: TEST_CONSTANTS.EMAIL,
        redirectTo: 'invalid-url'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 144:7 - Line 146:21), src\app\api\auth\forgot-password\route.test.ts (Line 125:7 - Line 127:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup124"><code class="language-typescript text-sm text-gray-800">}
      const request = mockRequest(invalidData)
      const mockParseError = { error: 'Invalid URL format'</code></pre></div><div class="py-4"><p class="text-gray-600">src\app\api\auth\forgot-password\route.test.ts (Line 146:2 - Line 159:2), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 139:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup125"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null,
        error: mockParseError
      })

      const response = await POST(request)

      expect(authApiUtils.parseRequestBody).toHaveBeenCalledWith(request, expect.any(Object))
      expect(response).toBe(mockParseError)
    })
  })
}</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 116:6 - Line 117:6), src\test\test-utils.ts (Line 107:5 - Line 108:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup126"><code class="language-typescript text-sm text-gray-800">: any = {}) =&gt; ({
    ok: false</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 117:6 - Line 119:6), src\test\test-utils.ts (Line 108:5 - Line 110:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup127"><code class="language-typescript text-sm text-gray-800">,
    json: vi.fn().mockResolvedValue({
      error</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 131:6 - Line 132:6), src\test\test-utils.ts (Line 127:5 - Line 128:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup128"><code class="language-typescript text-sm text-gray-800">: any = {}) =&gt; {
    mockFetch.mockResolvedValueOnce(createResponse.error</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 146:13 - Line 148:7), src\test\test-utils.ts (Line 141:3 - Line 143:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup129"><code class="language-typescript text-sm text-gray-800">)
    expect(result.current.message).toBe('')
    expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 147:8 - Line 148:8), src\test\test-utils.ts (Line 141:6 - Line 142:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup130"><code class="language-typescript text-sm text-gray-800">).toBe('')
    expect(result.current.loading</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 148:5 - Line 149:2), src\test\test-utils.ts (Line 140:5 - Line 141:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup131"><code class="language-typescript text-sm text-gray-800">expect(result.current.loading).toBe(false)
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 151:8 - Line 152:8), src\test\test-utils.ts (Line 145:13 - Line 146:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup132"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    expect(result.current.message</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 152:8 - Line 156:2), src\test\test-utils.ts (Line 140:6 - Line 149:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup133"><code class="language-typescript text-sm text-gray-800">)
    expect(result.current.error).toBe('')
    expect(result.current.loading).toBe(false)
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 167:10 - Line 168:3), src\test\test-utils.ts (Line 160:11 - Line 161:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup134"><code class="language-typescript text-sm text-gray-800">: (overrides = {}) =&gt; ({
    id</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 177:15 - Line 180:11), src\test\test-utils.ts (Line 160:11 - Line 163:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup135"><code class="language-typescript text-sm text-gray-800">: (overrides = {}) =&gt; ({
    loading: false,
    loadingText: TEST_CONSTANTS.LOADING_TEXT,
    buttonText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 186:24 - Line 187:6), src\test\test-utils.ts (Line 160:11 - Line 161:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup136"><code class="language-typescript text-sm text-gray-800">: (overrides = {}) =&gt; ({
    email</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 190:12 - Line 193:2), src\test\test-utils.ts (Line 173:9 - Line 175:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup137"><code class="language-typescript text-sm text-gray-800">: vi.fn(),
    ...overrides
  })
}</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 207:5 - Line 208:9), src\test\test-utils.ts (Line 203:10 - Line 204:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup138"><code class="language-typescript text-sm text-gray-800">: any) =&gt; {
    expect(mockFetch).toHaveBeenCalledWith(endpoint</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 241:13 - Line 242:12), src\test\test-utils.ts (Line 236:5 - Line 237:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup139"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    expect(screen.getByText(loadingText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 242:12 - Line 243:12), src\test\test-utils.ts (Line 237:5 - Line 238:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup140"><code class="language-typescript text-sm text-gray-800">)).toBeInTheDocument()
    expect(screen.queryByText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 243:4 - Line 244:13), src\test\test-utils.ts (Line 237:2 - Line 238:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup141"><code class="language-typescript text-sm text-gray-800">.toBeInTheDocument()
    expect(screen.getByRole('button')).toBeDisabled</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 247:21 - Line 248:10), src\test\test-utils.ts (Line 236:21 - Line 237:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup142"><code class="language-typescript text-sm text-gray-800">: (text: string) =&gt; {
    expect(screen.getByRole</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 248:5 - Line 249:7), src\test\test-utils.ts (Line 238:5 - Line 245:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup143"><code class="language-typescript text-sm text-gray-800">expect(screen.getByRole('button')).toBeDisabled()
    expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 249:5 - Line 250:2), src\test\test-utils.ts (Line 237:5 - Line 238:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup144"><code class="language-typescript text-sm text-gray-800">expect(screen.getByText(text)).toBeInTheDocument()
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 253:12 - Line 254:10), src\test\test-utils.ts (Line 237:5 - Line 238:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup145"><code class="language-typescript text-sm text-gray-800">)).toBeInTheDocument()
    expect(screen.getByRole(inputType</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 263:10 - Line 264:10), src\test\test-utils.ts (Line 236:5 - Line 237:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup146"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    expect(screen.getByText(errorText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 264:10 - Line 265:10), src\test\test-utils.ts (Line 237:5 - Line 238:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup147"><code class="language-typescript text-sm text-gray-800">)).toBeInTheDocument()
    expect(screen.getByText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 274:6 - Line 277:10), src\test\test-utils.ts (Line 257:12 - Line 260:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup148"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).toBeInTheDocument()
    expect(input).toHaveAttribute(attribute</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 280:10 - Line 283:4), src\test\test-utils.ts (Line 257:12 - Line 260:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup149"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).toBeInTheDocument()
    expect(input).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 286:20 - Line 288:13), src\test\test-utils.ts (Line 257:28 - Line 259:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup150"><code class="language-typescript text-sm text-gray-800">: (placeholder: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).toBeRequired</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 291:23 - Line 293:4), src\test\test-utils.ts (Line 257:28 - Line 259:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup151"><code class="language-typescript text-sm text-gray-800">: (placeholder: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 296:30 - Line 298:12), src\test\test-utils.ts (Line 257:28 - Line 259:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup152"><code class="language-typescript text-sm text-gray-800">: (placeholder: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).toHaveClass</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 317:10 - Line 319:10), src\test\test-utils.ts (Line 257:12 - Line 299:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup153"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    expect(input).toHaveClass(className</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 324:2 - Line 327:7), src\test\test-utils.ts (Line 269:5 - Line 272:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup154"><code class="language-typescript text-sm text-gray-800">)
    expect(link).toBeInTheDocument()
    expect(link).toHaveAttribute('href', href)
    expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 341:16 - Line 342:21), src\test\test-utils.ts (Line 237:5 - Line 238:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup155"><code class="language-typescript text-sm text-gray-800">)).toBeInTheDocument()
    expect(screen.getByPlaceholderText</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 346:6 - Line 347:18), src\test\test-utils.ts (Line 237:5 - Line 238:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup156"><code class="language-typescript text-sm text-gray-800">)).toBeInTheDocument()
    expect(screen.getByDisplayValue</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 350:10 - Line 352:10), src\test\test-utils.ts (Line 257:12 - Line 259:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup157"><code class="language-typescript text-sm text-gray-800">: string) =&gt; {
    const input = screen.getByPlaceholderText(placeholder)
    fireEvent</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 358:23 - Line 359:10), src\test\test-utils.ts (Line 243:13 - Line 244:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup158"><code class="language-typescript text-sm text-gray-800">)).not.toBeInTheDocument()
    expect(container</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 362:28 - Line 363:18), src\test\test-utils.ts (Line 357:31 - Line 358:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup159"><code class="language-typescript text-sm text-gray-800">: (container: HTMLElement) =&gt; {
    expect(container.querySelector(TEST_CONSTANTS.STACKED_INPUT_SELECTOR)).toBeInTheDocument</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 365:2 - Line 368:26), src\test\test-utils.ts (Line 359:10 - Line 362:28)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup160"><code class="language-typescript text-sm text-gray-800">.querySelectorAll('div')).toHaveLength(2)
  },

  expectAuthLayoutWithTitle</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 377:12 - Line 378:8), src\test\test-utils.ts (Line 323:7 - Line 324:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup161"><code class="language-typescript text-sm text-gray-800">, ...classes: string[]) =&gt; {
    const spinner</code></pre></div><div class="py-4"><p class="text-gray-600">src\test\test-utils.ts (Line 387:10 - Line 390:12), src\test\test-utils.ts (Line 218:14 - Line 220:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup162"><code class="language-typescript text-sm text-gray-800">)

    const { result } = renderHook(() =&gt;
      useAuthForm</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 1:1 - Line 3:21), src\app\api\auth\reset-password\route.ts (Line 1:1 - Line 3:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup163"><code class="language-typescript text-sm text-gray-800">import { NextRequest } from 'next/server'
import { z } from 'zod'
import supabase from '../../lib/supabase'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 15:2 - Line 18:10), src\app\api\auth\login\route.ts (Line 6:2 - Line 11:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup164"><code class="language-typescript text-sm text-gray-800">= z.object({
  email: z.email(),
  password: z.string().min(MIN_PASSWORD_LENGTH),
  firstName</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 19:9 - Line 20:2), src\lib\registration-handler.ts (Line 18:10 - Line 19:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup165"><code class="language-typescript text-sm text-gray-800">: z.string().min(MIN_NAME_LENGTH),
}</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 23:2 - Line 24:15), src\app\api\auth\reset-password\route.ts (Line 13:2 - Line 14:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup166"><code class="language-typescript text-sm text-gray-800">{
    const { data: validatedData, error: parseError } = await parseRequestBody(request, RegisterSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 30:7 - Line 33:8), src\app\api\auth\login\route.ts (Line 19:19 - Line 22:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup167"><code class="language-typescript text-sm text-gray-800">({
      email: validatedData.email,
      password: validatedData.password,
      options</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 53:5 - Line 56:8), src\app\api\auth\login\route.ts (Line 36:3 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup168"><code class="language-typescript text-sm text-gray-800">return createSuccessResponse({
      user: data.user,
      session: data.session,
      message</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.ts (Line 56:27 - Line 60:22), src\app\api\auth\logout\route.ts (Line 22:26 - Line 25:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup169"><code class="language-typescript text-sm text-gray-800">,
    })

  } catch (err) {
    console.error('Registration error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 1:1 - Line 2:19), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 2:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup170"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { handleRegistration</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 5:1 - Line 11:19), src\app\api\auth\reset-password\route.test.ts (Line 6:1 - Line 12:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup171"><code class="language-typescript text-sm text-gray-800">// Mock NextRequest
const mockRequest = (body: any): any =&gt; ({
  json: vi.fn().mockResolvedValue(body)
})

// Mock auth-api-utils
vi.mock('./auth-api-utils'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 11:19 - Line 15:20), src\app\api\auth\reset-password\route.test.ts (Line 12:23 - Line 16:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup172"><code class="language-typescript text-sm text-gray-800">, () =&gt; ({
  parseRequestBody: vi.fn(),
  handleSupabaseError: vi.fn(),
  createSuccessResponse: vi.fn(),
  createErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 24:21 - Line 27:7), src\app\api\auth\reset-password\route.test.ts (Line 21:30 - Line 24:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup173"><code class="language-typescript text-sm text-gray-800">, () =&gt; ({
  default: {
    auth: {
      signUp</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 27:7 - Line 32:23), src\app\api\auth\reset-password\route.test.ts (Line 24:11 - Line 29:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup174"><code class="language-typescript text-sm text-gray-800">: vi.fn()
    }
  }
}))

describe('registration-handler'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 32:23 - Line 35:4), src\app\api\auth\reset-password\route.test.ts (Line 29:27 - Line 33:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup175"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  let authApiUtils: any
  let supabase: any
  let</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 36:17 - Line 44:13), src\app\api\auth\session\route.test.ts (Line 12:13 - Line 31:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup176"><code class="language-typescript text-sm text-gray-800">: any


  beforeEach(async () =&gt; {
    vi.clearAllMocks()
    console.log = vi.fn()
    console.error = vi.fn()

    authApiUtils</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 42:2 - Line 44:19), src\app\api\auth\login\route.test.ts (Line 34:2 - Line 36:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup177"><code class="language-typescript text-sm text-gray-800">= vi.fn()

    authApiUtils = await import('./auth-api-utils'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 57:2 - Line 67:21), src\app\api\auth\register\route.test.ts (Line 23:2 - Line 33:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup178"><code class="language-typescript text-sm text-gray-800">)
  })

  const validRegisterData = {
    email: TEST_CONSTANTS.EMAIL,
    password: TEST_CONSTANTS.PASSWORD,
    firstName: 'John',
    lastName: 'Doe'
  }

  describe('handleRegistration'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 68:77 - Line 70:9), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 36:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup179"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData)
      const mockUser</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 70:6 - Line 74:2), src\app\api\auth\login\route.test.ts (Line 56:8 - Line 58:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup180"><code class="language-typescript text-sm text-gray-800">, email: TEST_CONSTANTS.EMAIL }
      const mockSession = { access_token: 'token123' }
      const mockSuccessResponse = {
        user: mockUser,
        session: mockSession,</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 76:7 - Line 79:18), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 53:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup181"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validRegisterData</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 79:18 - Line 83:7), src\app\api\auth\reset-password\route.test.ts (Line 53:23 - Line 57:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup182"><code class="language-typescript text-sm text-gray-800">,
        error: null
      })

      supabase.auth.signUp</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 83:7 - Line 88:13), src\app\api\auth\login\route.test.ts (Line 65:23 - Line 70:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup183"><code class="language-typescript text-sm text-gray-800">.mockResolvedValue({
        data: { user: mockUser, session: mockSession },
        error: null
      })

      profileUtils</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 88:10 - Line 91:19), src\app\api\auth\reset-password\route.test.ts (Line 59:2 - Line 63:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup184"><code class="language-typescript text-sm text-gray-800">)
      authApiUtils.createSuccessResponse.mockReturnValue(mockSuccessResponse)

      const response = await handleRegistration</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 91:17 - Line 94:7), src\app\api\auth\session\route.test.ts (Line 49:12 - Line 51:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup185"><code class="language-typescript text-sm text-gray-800">)

      expect(response).toBe(mockSuccessResponse)
      expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 97:67 - Line 106:19), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 131:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup186"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest({})
      const mockParseError = { error: 'Invalid email format' }

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: null,
        error: mockParseError
      })

      const response = await handleRegistration</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 104:2 - Line 108:15), src\lib\registration-handler.test.ts (Line 89:20 - Line 93:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup187"><code class="language-typescript text-sm text-gray-800">)

      const response = await handleRegistration(request, mockPrismaClient)

      expect(response).toBe(mockParseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 106:17 - Line 109:7), src\app\api\auth\reset-password\route.test.ts (Line 134:2 - Line 136:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup188"><code class="language-typescript text-sm text-gray-800">)

      expect(response).toBe(mockParseError)
      expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 108:15 - Line 112:68), src\lib\registration-handler.test.ts (Line 93:20 - Line 97:67)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup189"><code class="language-typescript text-sm text-gray-800">)
      expect(mockPrismaClient.$disconnect).toHaveBeenCalled()
    })

    it('should call prisma.$disconnect in finally block on Supabase error'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 112:68 - Line 114:14), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 36:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup190"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData)
      const supabaseError</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 115:2 - Line 129:19), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 110:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup191"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validRegisterData,
        error: null
      })

      supabase.auth.signUp.mockResolvedValue({
        data: { user: null, session: null },
        error: supabaseError
      })

      authApiUtils.handleSupabaseError.mockReturnValue(mockErrorResponse)

      const response = await handleRegistration</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 127:18 - Line 131:18), src\lib\registration-handler.test.ts (Line 89:20 - Line 93:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup192"><code class="language-typescript text-sm text-gray-800">)

      const response = await handleRegistration(request, mockPrismaClient)

      expect(response).toBe(mockErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 129:17 - Line 132:7), src\app\api\auth\reset-password\route.test.ts (Line 115:14 - Line 117:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup193"><code class="language-typescript text-sm text-gray-800">)

      expect(response).toBe(mockErrorResponse)
      expect</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 131:18 - Line 132:25), src\app\api\auth\logout\route.test.ts (Line 97:7 - Line 98:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup194"><code class="language-typescript text-sm text-gray-800">)
      expect(console.error).toHaveBeenCalledWith('Supabase signup error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 132:14 - Line 136:68), src\lib\registration-handler.test.ts (Line 93:20 - Line 97:67)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup195"><code class="language-typescript text-sm text-gray-800">)
      expect(mockPrismaClient.$disconnect).toHaveBeenCalled()
    })

    it('should call prisma.$disconnect in finally block when user is null'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 136:68 - Line 138:18), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 36:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup196"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData)
      const mockErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 138:2 - Line 147:5), src\app\api\auth\reset-password\route.test.ts (Line 50:7 - Line 126:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup197"><code class="language-typescript text-sm text-gray-800">}

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validRegisterData,
        error: null
      })

      supabase.auth.signUp.mockResolvedValue({
        data: { user: null, session: null },
        error: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 146:5 - Line 150:20), src\app\api\auth\login\route.test.ts (Line 164:9 - Line 168:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup198"><code class="language-typescript text-sm text-gray-800">, session: null },
        error: null
      })

      authApiUtils.createErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 150:20 - Line 155:13), src\lib\registration-handler.test.ts (Line 127:20 - Line 132:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup199"><code class="language-typescript text-sm text-gray-800">.mockReturnValue(mockErrorResponse)

      const response = await handleRegistration(request, mockPrismaClient)

      expect(response).toBe(mockErrorResponse)
      expect(authApiUtils</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 155:9 - Line 159:70), src\lib\registration-handler.test.ts (Line 93:20 - Line 97:67)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup200"><code class="language-typescript text-sm text-gray-800">)
      expect(mockPrismaClient.$disconnect).toHaveBeenCalled()
    })

    it('should call prisma.$disconnect in finally block on unexpected error'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 159:70 - Line 161:10), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 36:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup201"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData)
      const testError</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 161:2 - Line 162:15), src\app\api\auth\logout\route.test.ts (Line 86:2 - Line 87:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup202"><code class="language-typescript text-sm text-gray-800">= new Error('Unexpected error')
      const mockErrorResponse = { error: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 162:28 - Line 169:46), src\lib\registration-handler.test.ts (Line 138:23 - Line 83:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup203"><code class="language-typescript text-sm text-gray-800">, status: TEST_CONSTANTS.HTTP_500 }

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validRegisterData,
        error: null
      })

      // Mock supabase throwing an unexpected error</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 170:10 - Line 177:22), src\lib\registration-handler.test.ts (Line 148:2 - Line 98:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup204"><code class="language-typescript text-sm text-gray-800">)

      authApiUtils.createErrorResponse.mockReturnValue(mockErrorResponse)

      const response = await handleRegistration(request, mockPrismaClient)

      expect(response).toBe(mockErrorResponse)
      expect(console.error).toHaveBeenCalledWith('Registration error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 177:10 - Line 178:15), src\lib\registration-handler.test.ts (Line 154:18 - Line 155:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup205"><code class="language-typescript text-sm text-gray-800">)
      expect(authApiUtils.createErrorResponse).toHaveBeenCalledWith(TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 178:28 - Line 182:86), src\lib\registration-handler.test.ts (Line 155:23 - Line 97:67)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup206"><code class="language-typescript text-sm text-gray-800">, TEST_CONSTANTS.HTTP_500)
      expect(mockPrismaClient.$disconnect).toHaveBeenCalled()
    })

    it('should call prisma.$disconnect in finally block when ensureUserProfile throws error'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 182:86 - Line 186:13), src\app\api\auth\reset-password\route.test.ts (Line 46:43 - Line 58:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup207"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = mockRequest(validRegisterData)
      const mockUser = { id: '123', email: TEST_CONSTANTS.EMAIL }
      const mockSession = { access_token: 'token123' }
      const profileError</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 186:26 - Line 199:44), src\lib\registration-handler.test.ts (Line 161:19 - Line 70:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup208"><code class="language-typescript text-sm text-gray-800">)
      const mockErrorResponse = { error: TEST_CONSTANTS.REGISTRATION_FAILED_MESSAGE, status: TEST_CONSTANTS.HTTP_500 }

      authApiUtils.parseRequestBody.mockResolvedValue({
        data: validRegisterData,
        error: null
      })

      supabase.auth.signUp.mockResolvedValue({
        data: { user: mockUser, session: mockSession },
        error: null
      })

      // Mock ensureUserProfile throwing an error</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 200:13 - Line 206:13), src\lib\registration-handler.test.ts (Line 148:2 - Line 177:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup209"><code class="language-typescript text-sm text-gray-800">)
      authApiUtils.createErrorResponse.mockReturnValue(mockErrorResponse)

      const response = await handleRegistration(request, mockPrismaClient)

      expect(response).toBe(mockErrorResponse)
      expect(console.error).toHaveBeenCalledWith('Registration error:', profileError</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\registration-handler.test.ts (Line 206:13 - Line 209:2), src\lib\registration-handler.test.ts (Line 93:20 - Line 97:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup210"><code class="language-typescript text-sm text-gray-800">)
      expect(mockPrismaClient.$disconnect).toHaveBeenCalled()
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 1:1 - Line 2:18), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 2:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup211"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { ensureUserProfile</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 13:16 - Line 19:40), src\app\api\auth\register\route.test.ts (Line 21:21 - Line 31:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup212"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  beforeEach(() =&gt; {
    vi.clearAllMocks()
    console.log = vi.fn()
    console.error = vi.fn()

    // Mock setTimeout for the trigger wait</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 19:5 - Line 26:14), src\lib\registration-handler.test.ts (Line 53:5 - Line 60:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup213"><code class="language-typescript text-sm text-gray-800">// Mock setTimeout for the trigger wait
    vi.spyOn(global, 'setTimeout').mockImplementation((callback: any) =&gt; {
      callback()
      return {} as any
    })
  })

  const testFirstName</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 33:2 - Line 35:2), src\app\api\auth\session\route.test.ts (Line 39:2 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup214"><code class="language-typescript text-sm text-gray-800">{
        id: TEST_CONSTANTS.USER_ID,
        email: TEST_CONSTANTS.EMAIL,</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 46:5 - Line 50:2), src\app\api\auth\session\route.test.ts (Line 39:5 - Line 38:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup215"><code class="language-typescript text-sm text-gray-800">: {
          id: TEST_CONSTANTS.USER_ID,
          email: TEST_CONSTANTS.EMAIL,
          firstName: testFirstName,
          lastName: testLastName,</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 52:7 - Line 53:55), src\app\api\auth\logout\route.test.ts (Line 56:7 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup216"><code class="language-typescript text-sm text-gray-800">})
      expect(console.log).toHaveBeenCalledWith('Trigger did not create profile, creating manually...'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 53:55 - Line 54:37), src\app\api\auth\logout\route.test.ts (Line 56:2 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup217"><code class="language-typescript text-sm text-gray-800">)
      expect(console.log).toHaveBeenCalledWith('Profile created manually for user:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 58:2 - Line 65:36), src\app\api\auth\login\route.test.ts (Line 56:2 - Line 38:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup218"><code class="language-typescript text-sm text-gray-800">= {
        id: TEST_CONSTANTS.USER_ID,
        email: TEST_CONSTANTS.EMAIL,
        firstName: testFirstName,
        lastName: testLastName
      }

      // Mock that profile already exists</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 66:16 - Line 73:4), src\lib\profile-utils.test.ts (Line 38:2 - Line 45:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup219"><code class="language-typescript text-sm text-gray-800">)

      await ensureUserProfile(TEST_CONSTANTS.USER_ID, TEST_CONSTANTS.EMAIL, testFirstName, testLastName, mockPrismaClient)

      expect(mockPrismaClient.profile.findUnique).toHaveBeenCalledWith({
        where: { id: TEST_CONSTANTS.USER_ID }
      })
      expect(mockPrismaClient.profile.create).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 73:2 - Line 74:47), src\app\api\auth\logout\route.test.ts (Line 56:2 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup220"><code class="language-typescript text-sm text-gray-800">)
      expect(console.log).toHaveBeenCalledWith('Profile already exists (created by trigger):'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\profile-utils.test.ts (Line 84:14 - Line 86:26), src\app\api\auth\logout\route.test.ts (Line 109:5 - Line 98:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup221"><code class="language-typescript text-sm text-gray-800">()

      expect(console.error).toHaveBeenCalledWith('Error creating profile:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.ts (Line 1:2 - Line 3:28), src\app\api\auth\reset-password\route.ts (Line 1:2 - Line 3:37)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup222"><code class="language-typescript text-sm text-gray-800">} from 'next/server'
import { z } from 'zod'
import { createSupabaseServerClient } from '../../lib/supabase-server'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.ts (Line 8:7 - Line 9:8), src\app\api\auth\logout\route.ts (Line 14:6 - Line 16:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup223"><code class="language-typescript text-sm text-gray-800">) {
  return NextResponse.json({ error: message</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.ts (Line 71:2 - Line 73:2), src\app\api\auth\logout\route.ts (Line 5:2 - Line 19:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup224"><code class="language-typescript text-sm text-gray-800">{
  const supabase = await createSupabaseServerClient()
  const { data:</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.ts (Line 81:3 - Line 84:26), src\lib\registration-handler.ts (Line 39:5 - Line 42:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup225"><code class="language-typescript text-sm text-gray-800">})

  if (error) {
    console.error('Supabase session error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 1:1 - Line 2:13), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 2:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup226"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { NextResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 1:2 - Line 3:2), src\app\api\auth\register\route.test.ts (Line 2:2 - Line 4:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup227"><code class="language-typescript text-sm text-gray-800">} from 'vitest'
import { NextResponse } from 'next/server'
import { z</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 2:1 - Line 4:15), src\lib\auth-api-utils.ts (Line 1:1 - Line 3:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup228"><code class="language-typescript text-sm text-gray-800">import { NextResponse } from 'next/server'
import { z } from 'zod'
import { TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 15:1 - Line 17:2), src\app\api\auth\logout\route.test.ts (Line 5:1 - Line 7:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup229"><code class="language-typescript text-sm text-gray-800">vi.mock('next/server', () =&gt; ({
  NextResponse: {
    json: vi.fn((</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 31:28 - Line 32:2), src\app\api\auth\logout\route.test.ts (Line 12:37 - Line 13:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup230"><code class="language-typescript text-sm text-gray-800">, () =&gt; ({
  createSupabaseServerClient: vi.fn((</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 37:8 - Line 39:42), src\lib\auth-api-utils.test.ts (Line 36:6 - Line 37:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup231"><code class="language-typescript text-sm text-gray-800">).mockImplementation(() =&gt; {})

// Helper functions to reduce duplication</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 40:2 - Line 41:5), src\app\api\auth\reset-password\route.test.ts (Line 7:2 - Line 8:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup232"><code class="language-typescript text-sm text-gray-800">=&gt; ({
  json: vi.fn().mockResolvedValue(data</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 44:6 - Line 45:18), src\lib\auth-api-utils.test.ts (Line 40:7 - Line 8:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup233"><code class="language-typescript text-sm text-gray-800">) =&gt; ({
  json: vi.fn().mockRejectedValue</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 45:6 - Line 48:20), src\lib\auth-api-utils.test.ts (Line 41:5 - Line 44:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup234"><code class="language-typescript text-sm text-gray-800">)
} as Pick&lt;Request, 'json'&gt;)

const expectErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 49:3 - Line 50:8), src\app\api\auth\logout\route.test.ts (Line 54:7 - Line 75:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup235"><code class="language-typescript text-sm text-gray-800">expect(NextResponse.json).toHaveBeenCalledWith(
    { error: message</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 49:21 - Line 55:6), src\lib\auth-api-utils.ts (Line 9:5 - Line 14:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup236"><code class="language-typescript text-sm text-gray-800">(
    { error: message },
    { status }
  )
}

const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 64:2 - Line 66:15), src\app\api\auth\login\route.ts (Line 6:2 - Line 10:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup237"><code class="language-typescript text-sm text-gray-800">z.object({
  email: z.email(),
  password: z.string().min(TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 80:3 - Line 83:6), src\lib\auth-api-utils.test.ts (Line 74:5 - Line 76:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup238"><code class="language-typescript text-sm text-gray-800">expect(result.error).toBeUndefined()
}

const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 83:2 - Line 84:9), src\lib\auth-api-utils.test.ts (Line 78:7 - Line 79:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup239"><code class="language-typescript text-sm text-gray-800">) =&gt; {
  expect(result.session).toBeNull</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 85:3 - Line 88:6), src\lib\auth-api-utils.test.ts (Line 72:5 - Line 73:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup240"><code class="language-typescript text-sm text-gray-800">expect(result.error).toBeDefined()
}

const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 117:17 - Line 122:9), src\app\api\auth\register\route.test.ts (Line 21:21 - Line 26:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup241"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  beforeEach(() =&gt; {
    vi.clearAllMocks()
  })

  describe</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 124:9 - Line 127:15), src\app\api\auth\logout\route.test.ts (Line 53:2 - Line 75:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup242"><code class="language-typescript text-sm text-gray-800">)

      expect(NextResponse.json).toHaveBeenCalledWith(
        { error: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 129:7 - Line 131:15), src\lib\auth-api-utils.test.ts (Line 107:15 - Line 109:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup243"><code class="language-typescript text-sm text-gray-800">)
      expect(result).toEqual({
        json: { error: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 145:5 - Line 147:5), src\app\api\auth\logout\route.test.ts (Line 53:2 - Line 54:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup244"><code class="language-typescript text-sm text-gray-800">)

      expect(NextResponse.json).toHaveBeenCalledWith(data</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 147:2 - Line 149:5), src\lib\auth-api-utils.test.ts (Line 128:2 - Line 109:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup245"><code class="language-typescript text-sm text-gray-800">})
      expect(result).toEqual({
        json: data</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 156:9 - Line 158:15), src\app\api\auth\logout\route.test.ts (Line 53:2 - Line 147:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup246"><code class="language-typescript text-sm text-gray-800">)

      expect(NextResponse.json).toHaveBeenCalledWith(data, { status: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 169:7 - Line 172:2), src\lib\auth-api-utils.test.ts (Line 145:2 - Line 148:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup247"><code class="language-typescript text-sm text-gray-800">createSuccessResponse(data)

      expect(NextResponse.json).toHaveBeenCalledWith(data, { status: 200 })
    }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 183:9 - Line 185:22), src\lib\auth-api-utils.test.ts (Line 107:15 - Line 131:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup248"><code class="language-typescript text-sm text-gray-800">)
        expect(result).toEqual({
          json: { error: TEST_CONSTANTS.INVALID_INPUT_MESSAGE</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 185:2 - Line 189:2), src\lib\auth-api-utils.test.ts (Line 131:2 - Line 134:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup249"><code class="language-typescript text-sm text-gray-800">},
          status: TEST_CONSTANTS.HTTP_400
        })
      }
    }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 191:2 - Line 192:23), src\app\api\auth\logout\route.test.ts (Line 64:2 - Line 65:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup250"><code class="language-typescript text-sm text-gray-800">() =&gt; {
      const error = new Error('Something went wrong'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 198:7 - Line 200:2), src\lib\auth-api-utils.test.ts (Line 193:7 - Line 196:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup251"><code class="language-typescript text-sm text-gray-800">testAuthApiErrorResponse(error, TEST_CONSTANTS.INTERNAL_SERVER_ERROR_MESSAGE, TEST_CONSTANTS.HTTP_500)
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 198:30 - Line 202:22), src\lib\auth-api-utils.test.ts (Line 138:15 - Line 142:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup252"><code class="language-typescript text-sm text-gray-800">, TEST_CONSTANTS.HTTP_500)
    })
  })

  describe('handleSupabaseError'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 203:53 - Line 204:15), src\lib\auth-api-utils.test.ts (Line 196:59 - Line 197:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup253"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
      const error = { message: TEST_CONSTANTS</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 207:28 - Line 209:28), src\lib\auth-api-utils.test.ts (Line 183:22 - Line 131:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup254"><code class="language-typescript text-sm text-gray-800">, TEST_CONSTANTS.HTTP_400)
      expect(result).toEqual({
        json: { error: TEST_CONSTANTS.INVALID_CREDENTIALS_MESSAGE</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 209:2 - Line 213:2), src\lib\auth-api-utils.test.ts (Line 131:2 - Line 136:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup255"><code class="language-typescript text-sm text-gray-800">},
        status: TEST_CONSTANTS.HTTP_400
      })
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 226:59 - Line 228:12), src\lib\auth-api-utils.test.ts (Line 216:47 - Line 218:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup256"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const schema = createEmailPasswordSchema()
      const invalidData</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 229:12 - Line 233:2), src\lib\auth-api-utils.test.ts (Line 219:9 - Line 223:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup257"><code class="language-typescript text-sm text-gray-800">)

      const result = await parseRequestBody(mockRequest as Request, schema)

      expectParseRequestResult(result, {</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 233:5 - Line 235:2), src\lib\auth-api-utils.test.ts (Line 181:9 - Line 184:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup258"><code class="language-typescript text-sm text-gray-800">)
      expectErrorResponse(TEST_CONSTANTS.INVALID_INPUT_MESSAGE, TEST_CONSTANTS.HTTP_400)
    }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 237:2 - Line 238:5), src\lib\auth-api-utils.test.ts (Line 176:2 - Line 177:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup259"><code class="language-typescript text-sm text-gray-800">() =&gt; {
      const schema = z.object({ test</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 239:2 - Line 244:30), src\lib\auth-api-utils.test.ts (Line 219:9 - Line 234:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup260"><code class="language-typescript text-sm text-gray-800">)

      const result = await parseRequestBody(mockRequest as Request, schema)

      expectParseRequestResult(result, {}, true)
      expectErrorResponse(TEST_CONSTANTS.INTERNAL_SERVER_ERROR_MESSAGE</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 244:2 - Line 248:18), src\lib\auth-api-utils.test.ts (Line 193:2 - Line 142:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup261"><code class="language-typescript text-sm text-gray-800">TEST_CONSTANTS.INTERNAL_SERVER_ERROR_MESSAGE, TEST_CONSTANTS.HTTP_500)
    })
  })

  describe('validateSession'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 249:50 - Line 250:11), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 39:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup262"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = { user: { id: 'user-123'</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 254:74 - Line 256:5), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 251:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup263"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = { user: { id: 'user-123' } }
      await testValidSessionScenario(mockSession, true</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 262:7 - Line 263:2), src\lib\auth-api-utils.test.ts (Line 89:3 - Line 90:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup264"><code class="language-typescript text-sm text-gray-800">mockSupabaseClient.auth.getSession.mockResolvedValue({
        data: { session:</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 263:2 - Line 267:6), src\app\api\auth\login\route.test.ts (Line 125:2 - Line 129:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup265"><code class="language-typescript text-sm text-gray-800">session: null },
        error: supabaseError
      })

      const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 274:2 - Line 277:5), src\lib\auth-api-utils.test.ts (Line 88:5 - Line 264:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup266"><code class="language-typescript text-sm text-gray-800">) =&gt; {
      mockSupabaseClient.auth.getSession.mockResolvedValue({
        data: { session: null },
        error: null</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 276:2 - Line 280:6), src\app\api\auth\login\route.test.ts (Line 164:2 - Line 168:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup267"><code class="language-typescript text-sm text-gray-800">session: null },
        error: null
      })

      const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 278:7 - Line 283:20), src\lib\auth-api-utils.test.ts (Line 265:7 - Line 270:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup268"><code class="language-typescript text-sm text-gray-800">})

      const result = await validateSession()

      expectInvalidSessionResult(result)
      expectErrorResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 287:78 - Line 292:19), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 74:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup269"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = {
        user: null
      }

      mockSupabaseClient</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 290:7 - Line 293:12), src\lib\auth-api-utils.test.ts (Line 260:2 - Line 263:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup270"><code class="language-typescript text-sm text-gray-800">}

      mockSupabaseClient.auth.getSession.mockResolvedValue({
        data: { session: mockSession</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 293:2 - Line 297:6), src\app\api\auth\login\route.test.ts (Line 66:2 - Line 70:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup271"><code class="language-typescript text-sm text-gray-800">session: mockSession },
        error: null
      })

      const</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 293:2 - Line 297:5), src\lib\auth-api-utils.test.ts (Line 276:2 - Line 280:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup272"><code class="language-typescript text-sm text-gray-800">},
        error: null
      })

      const result = await validateSession(true</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 297:5 - Line 301:2), src\lib\auth-api-utils.test.ts (Line 280:2 - Line 284:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup273"><code class="language-typescript text-sm text-gray-800">)

      expectInvalidSessionResult(result)
      expectErrorResponse('No active session', TEST_CONSTANTS.HTTP_401)
    }</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 303:84 - Line 305:6), src\app\api\auth\session\route.test.ts (Line 37:61 - Line 74:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup274"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const mockSession = { user: null }
      await</code></pre></div><div class="py-4"><p class="text-gray-600">src\lib\auth-api-utils.test.ts (Line 304:2 - Line 307:2), src\lib\auth-api-utils.test.ts (Line 250:2 - Line 254:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup275"><code class="language-typescript text-sm text-gray-800">}
      await testValidSessionScenario(mockSession, false, true)
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\hooks\useAuthForm.ts (Line 28:6 - Line 31:2), src\test\test-utils.ts (Line 208:21 - Line 212:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup276"><code class="language-typescript text-sm text-gray-800">(endpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',</code></pre></div><div class="py-4"><p class="text-gray-600">src\hooks\useAuthForm.ts (Line 34:2 - Line 36:13), src\hooks\useAuthRedirect.ts (Line 15:20 - Line 16:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup277"><code class="language-typescript text-sm text-gray-800">)

      const data = await response.json() as AuthFormData</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.ts (Line 20:8 - Line 24:84), src\middleware.ts (Line 16:15 - Line 20:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup278"><code class="language-typescript text-sm text-gray-800">)) {
    return NextResponse.redirect(new URL(LOGIN_PATH, request.url))
  }

  // If user is signed in and the current path is an auth page, redirect to dashboard</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.ts (Line 25:8 - Line 26:15), src\middleware.ts (Line 16:15 - Line 17:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup279"><code class="language-typescript text-sm text-gray-800">)) {
    return NextResponse.redirect(new URL(DASHBOARD_PATH</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 1:1 - Line 2:12), src\app\api\auth\session\route.test.ts (Line 1:1 - Line 2:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup280"><code class="language-typescript text-sm text-gray-800">import { describe, it, expect, vi, beforeEach } from 'vitest'
import { NextRequest</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 12:5 - Line 17:9), src\app\api\auth\reset-password\route.test.ts (Line 24:11 - Line 27:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup281"><code class="language-typescript text-sm text-gray-800">: vi.fn()
    }
  }
})

describe</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 27:3 - Line 31:13), src\app\api\auth\logout\route.test.ts (Line 25:3 - Line 16:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup282"><code class="language-typescript text-sm text-gray-800">}

  beforeEach(async () =&gt; {
    vi.clearAllMocks()
    NextResponse</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 30:14 - Line 32:2), src\app\api\auth\logout\route.test.ts (Line 30:3 - Line 32:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup283"><code class="language-typescript text-sm text-gray-800">()
    NextResponse = (await import('next/server')).NextResponse
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 57:70 - Line 58:17), src\middleware.test.ts (Line 49:61 - Line 50:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup284"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest('/auth/register'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 58:17 - Line 65:54), src\middleware.test.ts (Line 50:11 - Line 57:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup285"><code class="language-typescript text-sm text-gray-800">, authCookies)

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.DASHBOARD, request.url))
    })

    it('should allow authenticated user to access dashboard'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 65:54 - Line 66:10), src\middleware.test.ts (Line 49:61 - Line 50:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup286"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.DASHBOARD</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 66:10 - Line 70:4), src\middleware.test.ts (Line 50:11 - Line 54:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup287"><code class="language-typescript text-sm text-gray-800">, authCookies)

      await middleware(request)

      expect(NextResponse.redirect).not</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 74:49 - Line 75:8), src\middleware.test.ts (Line 49:61 - Line 50:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup288"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest('/chat'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 75:8 - Line 82:2), src\middleware.test.ts (Line 50:11 - Line 74:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup289"><code class="language-typescript text-sm text-gray-800">, authCookies)

      await middleware(request)

      expect(NextResponse.redirect).not.toHaveBeenCalled()
      expect(NextResponse.next).toHaveBeenCalled()
    })
  }</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 85:63 - Line 86:2), src\middleware.test.ts (Line 49:61 - Line 66:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup290"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.DASHBOARD)</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 86:10 - Line 90:11), src\middleware.test.ts (Line 50:12 - Line 54:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup291"><code class="language-typescript text-sm text-gray-800">)

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.AUTH_LOGIN</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 90:11 - Line 93:58), src\middleware.test.ts (Line 54:10 - Line 57:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup292"><code class="language-typescript text-sm text-gray-800">, request.url))
    })

    it('should redirect unauthenticated user from chat to login'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 93:58 - Line 94:2), src\middleware.test.ts (Line 49:61 - Line 75:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup293"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest('/chat')</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 94:8 - Line 101:57), src\middleware.test.ts (Line 50:12 - Line 57:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup294"><code class="language-typescript text-sm text-gray-800">)

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.AUTH_LOGIN, request.url))
    })

    it('should allow unauthenticated user to access auth pages'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 101:57 - Line 102:2), src\middleware.test.ts (Line 49:61 - Line 50:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup295"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.AUTH_LOGIN)</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 102:11 - Line 110:59), src\middleware.test.ts (Line 50:12 - Line 74:49)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup296"><code class="language-typescript text-sm text-gray-800">)

      await middleware(request)

      expect(NextResponse.redirect).not.toHaveBeenCalled()
      expect(NextResponse.next).toHaveBeenCalled()
    })

    it('should allow unauthenticated user to access public pages'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 110:59 - Line 111:4), src\middleware.test.ts (Line 49:61 - Line 50:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup297"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest('/'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 111:4 - Line 120:24), src\middleware.test.ts (Line 50:12 - Line 84:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup298"><code class="language-typescript text-sm text-gray-800">)

      await middleware(request)

      expect(NextResponse.redirect).not.toHaveBeenCalled()
      expect(NextResponse.next).toHaveBeenCalled()
    })
  })

  describe('auth cookie detection'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 121:63 - Line 122:2), src\middleware.test.ts (Line 49:61 - Line 50:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup299"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.AUTH_LOGIN, [</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 124:2 - Line 131:46), src\middleware.test.ts (Line 50:12 - Line 57:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup300"><code class="language-typescript text-sm text-gray-800">)

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.DASHBOARD, request.url))
    })

    it('should not detect non-auth supabase cookies'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 131:46 - Line 132:2), src\middleware.test.ts (Line 49:61 - Line 66:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup301"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.DASHBOARD, [</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 133:2 - Line 141:36), src\middleware.test.ts (Line 123:2 - Line 57:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup302"><code class="language-typescript text-sm text-gray-800">}
      ])

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.AUTH_LOGIN, request.url))
    })

    it('should not detect regular cookies'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 141:36 - Line 143:17), src\middleware.test.ts (Line 49:61 - Line 133:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup303"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
      const request = createRequest(PATHS.DASHBOARD, [
        { name: 'regular-cookie'</code></pre></div><div class="py-4"><p class="text-gray-600">src\middleware.test.ts (Line 143:2 - Line 150:2), src\middleware.test.ts (Line 123:2 - Line 93:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup304"><code class="language-typescript text-sm text-gray-800">}
      ])

      await middleware(request)

      expect(NextResponse.redirect).toHaveBeenCalledWith(new URL(PATHS.AUTH_LOGIN, request.url))
    })
  }</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>